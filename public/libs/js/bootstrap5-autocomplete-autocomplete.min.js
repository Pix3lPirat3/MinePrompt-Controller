var x={showAllSuggestions:!1,suggestionsThreshold:1,maximumItems:0,autoselectFirst:!0,ignoreEnter:!1,updateOnSelect:!1,highlightTyped:!1,highlightClass:"",fullWidth:!1,fixed:!1,fuzzy:!1,startsWith:!1,fillIn:!1,preventBrowserAutocomplete:!1,itemClass:"",activeClasses:["bg-primary","text-white"],labelField:"label",valueField:"value",searchFields:["label"],queryParam:"query",items:[],source:null,hiddenInput:!1,hiddenValue:"",clearControl:"",datalist:"",server:"",serverMethod:"GET",serverParams:{},serverDataKey:"data",fetchOptions:{},liveServer:!1,noCache:!0,debounceTime:300,notFoundMessage:"",onRenderItem:(o,t,e)=>t,onSelectItem:(o,t)=>{},onServerResponse:(o,t)=>o.json(),onChange:(o,t)=>{},onBeforeFetch:o=>{},onAfterFetch:o=>{}},C="is-loading",E="is-active",f="show",m="next",v="prev",p=new WeakMap,A=0,b=0;function O(o,t=300){let e;return(...s)=>{clearTimeout(e),e=setTimeout(()=>{o.apply(this,s)},t)}}function I(o){return o.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function y(o){return o?I(o.toString()).toLowerCase():""}function D(o,t){if(o.indexOf(t)>=0)return!0;let e=0;for(let s=0;s<t.length;s++){let i=t[s];if(i!=" "&&(e=o.indexOf(i,e)+1,e<=0))return!1}return!0}function T(o,t){return o.parentNode.insertBefore(t,o.nextSibling)}function M(o){var t=document.createElement("textarea");return t.innerHTML=o,t.value}function w(o,t){for(let[e,s]of Object.entries(t))o.setAttribute(e,s)}function F(o){o.ariaLabel=o.innerText,o.innerHTML=o.innerText.split("").map(t=>t+"&zwj;").join("")}function H(o,t="window"){return o.split(".").reduce((e,s)=>e[s],t)}var S=class{constructor(t,e={}){if(!(t instanceof HTMLElement)){console.error("Invalid element",t);return}p.set(t,this),A++,b++,this.s=t,this.L(e),this.c=!1,this.a=!1,this.C=O(()=>{this.p(!0)},this.e.debounceTime),this.E(),this.A(),this.e.fixed&&(document.addEventListener("scroll",this,!0),window.addEventListener("resize",this));let s=this.g();s&&s.addEventListener("click",this),["focus","change","blur","input","keydown"].forEach(i=>{this.s.addEventListener(i,this)}),["mousemove","mouseleave"].forEach(i=>{this.i.addEventListener(i,this)}),this.T()}static init(t="input.autocomplete",e={}){document.querySelectorAll(t).forEach(i=>{this.getOrCreateInstance(i,e)})}static getInstance(t){return p.has(t)?p.get(t):null}static getOrCreateInstance(t,e={}){return this.getInstance(t)||new this(t,e)}dispose(){b--,["focus","change","blur","input","keydown"].forEach(e=>{this.s.removeEventListener(e,this)}),["mousemove","mouseleave"].forEach(e=>{this.i.removeEventListener(e,this)});let t=this.g();t&&t.removeEventListener("click",this),this.e.fixed&&b<=0&&(document.removeEventListener("scroll",this,!0),window.removeEventListener("resize",this)),this.i.parentElement.removeChild(this.i),p.delete(this.s)}g(){if(this.e.clearControl)return document.querySelector(this.e.clearControl)}handleEvent=t=>{["scroll","resize"].includes(t.type)?(this.v&&window.cancelAnimationFrame(this.v),this.v=window.requestAnimationFrame(()=>{this[`on${t.type}`](t)})):this[`on${t.type}`](t)};L(t={}){this.e=Object.assign({},x);let e={...t,...this.s.dataset},s=i=>["true","false","1","0",!0,!1].includes(i)&&!!JSON.parse(i);for(let[i,r]of Object.entries(x)){if(e[i]===void 0)continue;let n=e[i];switch(typeof r){case"number":this.e[i]=parseInt(n);break;case"boolean":this.e[i]=s(n);break;case"string":this.e[i]=n.toString();break;case"object":if(Array.isArray(r))if(typeof n=="string"){let a=n.includes("|")?"|":",";this.e[i]=n.split(a)}else this.e[i]=n;else this.e[i]=typeof n=="string"?JSON.parse(n):n;break;case"function":this.e[i]=typeof n=="string"?window[n]:n;break;default:this.e[i]=n;break}}}E(){if(this.s.autocomplete="off",this.s.spellcheck=!1,w(this.s,{"aria-autocomplete":"list","aria-haspopup":"menu","aria-expanded":"false",role:"combobox"}),this.s.id&&this.e.preventBrowserAutocomplete){let t=document.querySelector(`[for="${this.s.id}"]`);t&&F(t)}this.n=null,this.e.hiddenInput&&(this.n=document.createElement("input"),this.n.type="hidden",this.n.value=this.e.hiddenValue,this.n.name=this.s.name,this.s.name="_"+this.s.name,T(this.s,this.n))}A(){this.i=document.createElement("ul"),this.i.id="ac-menu-"+A,this.i.classList.add("dropdown-menu","autocomplete-menu","p-0"),this.i.style.maxHeight="280px",this.e.fullWidth||(this.i.style.maxWidth="360px"),this.e.fixed&&(this.i.style.position="fixed"),this.i.style.overflowY="auto",this.i.style.overscrollBehavior="contain",this.i.style.textAlign="unset",T(this.s,this.i),this.s.setAttribute("aria-controls",this.i.id)}onclick(t){t.target.matches(this.e.clearControl)&&this.clear()}oninput(t){this.c||(this.n&&(this.n.value=null),this.showOrSearch())}onchange(t){let e=this.s.value,s=Object.values(this.r).find(i=>i.label===e);this.e.onChange(s,this)}onblur(t){if(t.relatedTarget&&t.relatedTarget.classList.contains("modal")){this.s.focus();return}setTimeout(()=>{this.hideSuggestions()},100)}onfocus(t){this.showOrSearch()}onkeydown(t){switch(t.keyCode||t.key){case 13:case"Enter":if(this.isDropdownVisible()){let s=this.getSelection();s&&s.click(),(s||!this.e.ignoreEnter)&&t.preventDefault()}break;case 38:case"ArrowUp":t.preventDefault(),this.a=!0,this.u(v);break;case 40:case"ArrowDown":t.preventDefault(),this.a=!0,this.isDropdownVisible()?this.u(m):this.showOrSearch(!1);break;case 27:case"Escape":this.isDropdownVisible()&&(this.s.focus(),this.hideSuggestions());break}}onmousemove(t){this.a=!1}onmouseleave(t){this.removeSelection()}onscroll(t){this.d()}onresize(t){this.d()}getConfig(t=null){return t!==null?this.e[t]:this.e}setConfig(t,e){this.e[t]=e}setData(t){this.r={},this.h(t)}enable(){this.s.setAttribute("disabled","")}disable(){this.s.removeAttribute("disabled")}isDisabled(){return this.s.hasAttribute("disabled")||this.s.disabled||this.s.hasAttribute("readonly")}isDropdownVisible(){return this.i.classList.contains(f)}clear(){this.s.value="",this.n&&(this.n.value="")}getSelection(){return this.i.querySelector("a."+E)}removeSelection(){let t=this.getSelection();t&&t.classList.remove(...this.l())}l(){return[...this.e.activeClasses,E]}b(t){if(t.style.display==="none")return!1;let e=t.firstElementChild;return e.tagName==="A"&&!e.classList.contains("disabled")}u(t=m,e=null){let s=this.getSelection();if(s){let i=t===m?"nextSibling":"previousSibling";e=s.parentNode;do e=e[i];while(e&&!this.b(e));e?(s.classList.remove(...this.l()),t===v?e.parentNode.scrollTop=e.offsetTop-e.parentNode.offsetTop:e.offsetTop>e.parentNode.offsetHeight-e.offsetHeight&&(e.parentNode.scrollTop+=e.offsetHeight)):s&&(e=s.parentElement)}else{if(t===v)return e;if(!e)for(e=this.i.firstChild;e&&!this.b(e);)e=e.nextSibling}if(e){let i=e.querySelector("a");i.classList.add(...this.l()),this.s.setAttribute("aria-activedescendant",i.id),this.e.updateOnSelect&&(this.s.value=i.dataset.label)}else this.s.setAttribute("aria-activedescendant","");return e}k(){return this.isDisabled()?!1:this.s.value.length>=this.e.suggestionsThreshold}showOrSearch(t=!0){if(t&&!this.k()){this.hideSuggestions();return}this.e.liveServer?this.C():this.e.source?this.e.source(this.s.value,e=>{this.setData(e),this.f()}):this.f()}O(t){let e=this.m(),s=document.createElement("span");return e.append(s),s.classList.add("dropdown-header","text-truncate"),s.innerHTML=t,e}I(t,e){let s=e.label;if(this.e.highlightTyped){let n=y(s).indexOf(t);n!==-1&&(s=s.substring(0,n)+`<mark class="${this.e.highlightClass}">${s.substring(n,n+t.length)}</mark>`+s.substring(n+t.length,s.length))}s=this.e.onRenderItem(e,s,this);let i=this.m(),r=document.createElement("a");if(i.append(r),r.id=this.i.id+"-"+this.i.children.length,r.classList.add("dropdown-item","text-truncate"),this.e.itemClass&&r.classList.add(...this.e.itemClass.split(" ")),r.setAttribute("data-value",e.value),r.setAttribute("data-label",e.label),r.setAttribute("tabindex","-1"),r.setAttribute("role","menuitem"),r.setAttribute("href","#"),r.innerHTML=s,e.data)for(let[n,a]of Object.entries(e.data))r.dataset[n]=a;if(this.e.fillIn){let n=document.createElement("button");n.type="button",n.classList.add("btn","btn-link","border-0"),n.innerHTML=`<svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
      <path fill-rule="evenodd" d="M2 2.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1H3.707l10.147 10.146a.5.5 0 0 1-.708.708L3 3.707V8.5a.5.5 0 0 1-1 0z"/>
      </svg>`,i.append(n),i.classList.add("d-flex","justify-content-between"),n.addEventListener("click",a=>{this.s.value=e.label,this.s.focus()})}return r.addEventListener("mouseenter",n=>{this.a||(this.removeSelection(),i.querySelector("a").classList.add(...this.l()))}),r.addEventListener("mousedown",n=>{n.preventDefault()}),r.addEventListener("click",n=>{n.preventDefault(),this.c=!0,this.s.value=M(e.label),this.n&&(this.n.value=e.value),this.e.onSelectItem(e,this),this.hideSuggestions(),this.c=!1}),i}f(){if(document.activeElement!=this.s)return;let t=y(this.s.value);this.i.innerHTML="";let e=Object.keys(this.r),s=0,i=null,r=[];for(let n=0;n<e.length;n++){let a=e[n],h=this.r[a],c=this.e.showAllSuggestions||t.length===0,l=t.length==0&&this.e.suggestionsThreshold===0;!c&&t.length>0&&this.e.searchFields.forEach(u=>{let d=y(h[u]),g=!1;if(this.e.fuzzy)g=D(d,t);else{let L=d.indexOf(t);g=this.e.startsWith?L===0:L>=0}g&&(l=!0)});let k=l||t.length===0;if(c||l){if(s++,h.group&&!r.includes(h.group)){let d=this.O(h.group);this.i.appendChild(d),r.push(h.group)}let u=this.I(t,h);if(!i&&k&&(i=u),this.i.appendChild(u),this.e.maximumItems>0&&s>=this.e.maximumItems)break}}if(i&&this.e.autoselectFirst&&(this.removeSelection(),this.u(m,i)),s===0)if(this.e.notFoundMessage){let n=this.m();n.innerHTML=`<span class="dropdown-item">${this.e.notFoundMessage}</span>`,this.i.appendChild(n),this.w()}else this.hideSuggestions();else this.w()}m(){let t=document.createElement("li");return t.setAttribute("role","presentation"),t}w(){this.i.classList.add(f),this.i.setAttribute("role","menu"),w(this.s,{"aria-expanded":"true"}),this.d()}toggleSuggestions(t=!0){this.i.classList.contains(f)?this.hideSuggestions():this.showOrSearch(t)}hideSuggestions(){this.i.classList.remove(f),w(this.s,{"aria-expanded":"false"}),this.removeSelection()}getInput(){return this.s}getDropMenu(){return this.i}d(){let t=window.getComputedStyle(this.s),e=this.s.getBoundingClientRect(),s=t.direction==="rtl",i=this.e.fullWidth,r=this.e.fixed,n=null,a=null;r&&(n=e.x,a=e.y+e.height,s&&!i&&(n-=this.i.offsetWidth-e.width)),this.i.style.transform="unset",i&&(this.i.style.width=this.s.offsetWidth+"px"),n!==null&&(this.i.style.left=n+"px"),a!==null&&(this.i.style.top=a+"px");let h=this.i.getBoundingClientRect(),c=window.innerHeight;if(h.y+h.height>c){let l=i?e.height+4:e.height;this.i.style.transform="translateY(calc(-100.1% - "+l+"px))"}}T(){this.r={},this.h(this.e.items);let t=this.e.datalist;if(t){let e=document.querySelector(`#${t}`);if(e){let s=Array.from(e.children).map(i=>{let r=i.getAttribute("value")??i.innerHTML.toLowerCase(),n=i.innerHTML;return{value:r,label:n}});this.h(s)}else console.error(`Datalist not found ${t}`)}this.S(),this.e.server&&!this.e.liveServer&&this.p()}S(){if(this.e.hiddenInput&&!this.e.hiddenValue)for(let[t,e]of Object.entries(this.r))e.label==this.s.value&&(this.n.value=t)}h(t){let e=Object.keys(t);for(let s=0;s<e.length;s++){let i=e[s],r=t[i];if(r.group&&r.items){r.items.forEach(h=>h.group=r.group),this.h(r.items);continue}let n=typeof r=="string"?r:r.label,a=typeof r!="object"?{}:r;a.label=r[this.e.labelField]??n,a.value=r[this.e.valueField]??i,a.label&&(this.r[a.value]=a)}}p(t=!1){this.o&&this.o.abort(),this.o=new AbortController;let e=this.s.dataset.serverParams||{};typeof e=="string"&&(e=JSON.parse(e));let s=Object.assign({},this.e.serverParams,e);if(s[this.e.queryParam]=this.s.value,this.e.noCache&&(s.t=Date.now()),s.related){let a=document.getElementById(s.related);if(a){s.related=a.value;let h=a.getAttribute("name");h&&(s[h]=a.value)}}let i=new URLSearchParams(s),r=this.e.server,n=Object.assign(this.e.fetchOptions,{method:this.e.serverMethod||"GET",signal:this.o.signal});n.method==="POST"?n.body=i:r+="?"+i.toString(),this.s.classList.add(C),this.e.onBeforeFetch(this),fetch(r,n).then(a=>this.e.onServerResponse(a,this)).then(a=>{let h=H(this.e.serverDataKey,a)||a;this.setData(h),this.S(),this.o=null,t&&this.f()}).catch(a=>{a.name==="AbortError"||this.o.signal.aborted||console.error(a)}).finally(a=>{this.s.classList.remove(C),this.e.onAfterFetch(this)})}},j=S;export{j as default};
//# sourceMappingURL=autocomplete.min.js.map